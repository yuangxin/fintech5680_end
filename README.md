# FinBERT-LSTM å®æ—¶è‚¡ç¥¨é¢„æµ‹ç³»ç»Ÿ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªèåˆ**è‡ªç„¶è¯­è¨€å¤„ç†(NLP)**å’Œ**æ—¶é—´åºåˆ—é¢„æµ‹**çš„æ™ºèƒ½é‡‘èç³»ç»Ÿï¼Œé€šè¿‡åˆ†æé‡‘èæ–°é—»æƒ…æ„Ÿå’Œå†å²è‚¡ä»·æ•°æ®ï¼Œé¢„æµ‹ä¸‹ä¸ªæœˆçš„è‚¡ç¥¨æ”¶ç›Šç‡ã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… **å®æ—¶æ•°æ®é‡‡é›†** - ä»Polygon APIå’ŒMassive APIè·å–æœ€æ–°æ•°æ®
- âœ… **æƒ…æ„Ÿåˆ†æ** - ä½¿ç”¨FinBERTæ¨¡å‹åˆ†æé‡‘èæ–°é—»
- âœ… **æ—¶é—´åºåˆ—é¢„æµ‹** - LSTMæ·±åº¦å­¦ä¹ æ¨¡å‹é¢„æµ‹è‚¡ä»·
- âœ… **Webå¯è§†åŒ–** - Streamlitå‰ç«¯å±•ç¤ºé¢„æµ‹ç»“æœ
- âœ… **æ¨¡å—åŒ–æ¶æ„** - æ˜“äºç»´æŠ¤å’Œæ‰©å±•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸŒ åœ¨çº¿ä½“éªŒ

ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ç›´æ¥ä½“éªŒå®Œæ•´ç³»ç»Ÿï¼ˆæ— éœ€æœ¬åœ°å®‰è£…ï¼‰ï¼š

**[ğŸ“Š å¯åŠ¨å®æ—¶é¢„æµ‹ç³»ç»Ÿ](https://fintech5680end-hz5t7pjv8wfhniwcyxtnge.streamlit.app/)**

---

### ç¯å¢ƒé…ç½®

#### 1. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

**ä¸»è¦ä¾èµ–**:
```
torch>=1.10.0           # PyTorchæ·±åº¦å­¦ä¹ æ¡†æ¶
transformers>=4.0       # Hugging Faceå˜å‹å™¨åº“
streamlit>=1.0          # Web UIæ¡†æ¶
requests>=2.25          # HTTPè¯·æ±‚åº“
pandas>=1.2             # æ•°æ®å¤„ç†
numpy>=1.20             # æ•°å€¼è®¡ç®—
python-dotenv>=0.19     # ç¯å¢ƒå˜é‡ç®¡ç†
```

#### 2. é…ç½®APIå¯†é’¥

**æ–¹æ³•1: ç¯å¢ƒå˜é‡** (æ¨è)
```bash
# åˆ›å»º .env æ–‡ä»¶
POLYGON_API_KEY=your_polygon_key_here
NEWS_API_KEY=your_news_api_key_here
```

**æ–¹æ³•2: config.py**
```python
# config.py
POLYGON_API_KEY = "your_key"
NEWS_API_KEY = "your_key"
```

#### 3. éªŒè¯æ¨¡å‹æ–‡ä»¶
ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨:
```
model/LSTM_FINTECH.pth    # é¢„è®­ç»ƒæ¨¡å‹æƒé‡
```

### è¿è¡Œåº”ç”¨

#### æ–¹æ³•1: Webç•Œé¢ (æ¨è)
```bash
streamlit run streamlit_server.py
```

#### æ–¹æ³•2: å‘½ä»¤è¡Œ
```bash
python run_app.py
```

#### æ–¹æ³•3: å•ä¸ªé¢„æµ‹
```bash
python main.py AAPL
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç”¨æˆ·ç•Œé¢å±‚ (Streamlit Web UI)                 â”‚
â”‚     streamlit_server.py / run_app.py                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ ç”¨æˆ·è¾“å…¥è‚¡ç¥¨ä»£ç 
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å®æ—¶é¢„æµ‹å¤„ç†ç®¡é“ (main.py)       â”‚
        â”‚  åè°ƒæ•´ä¸ªé¢„æµ‹æµç¨‹                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                            â”‚
    ç¬¬1æ­¥â–¼                        ç¬¬2æ­¥â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥æœŸè®¡ç®—æ¨¡å—      â”‚        â”‚ ä»·æ ¼æ•°æ®è·å–      â”‚
â”‚ date_utils.py    â”‚        â”‚ data_module.py   â”‚
â”‚ â€¢ è·å–æ—¥æœŸèŒƒå›´   â”‚        â”‚ â€¢ Polygon API    â”‚
â”‚ â€¢ æ—¶é—´çª—å£       â”‚        â”‚ â€¢ æœˆåº¦è‚¡ä»·       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
              ç¬¬3æ­¥  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   æ–°é—»æ•°æ®é‡‡é›†            â”‚
        â”‚  Massive API / main.py   â”‚
        â”‚ â€¢ æŒ‰æœˆä»½æœç´¢æ–°é—»          â”‚
        â”‚ â€¢ è·å–æ–°é—»æ ‡é¢˜/æè¿°       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
              ç¬¬4æ­¥  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æƒ…æ„Ÿåˆ†ææ¨¡å— (FinBERT)    â”‚
        â”‚     model.py              â”‚
        â”‚ â€¢ åŠ è½½é¢„è®­ç»ƒæ¨¡å‹           â”‚
        â”‚ â€¢ åˆ†ç±»: ç§¯æ/æ¶ˆæ/ä¸­ç«‹    â”‚
        â”‚ â€¢ æœˆåº¦æƒ…æ„Ÿèšåˆ            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
              ç¬¬5æ­¥  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ç‰¹å¾å·¥ç¨‹ & æ•°æ®è§„èŒƒåŒ–     â”‚
        â”‚  main.py                 â”‚
        â”‚ è¾“å…¥çŸ©é˜µ(4Ã—2):           â”‚
        â”‚ [æœˆæ¶¨å¹…, æƒ…æ„ŸæŒ‡æ ‡]        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
              ç¬¬6æ­¥  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   LSTMæ¨¡å‹æ¨ç†            â”‚
        â”‚  model.py                â”‚
        â”‚  é¢„æµ‹ä¸‹æœˆæ¶¨å¹…             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
              ç¬¬7æ­¥  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ç»“æœå¤„ç† & å¯è§†åŒ–         â”‚
        â”‚  é¢„æµ‹è‚¡ä»·ã€å›¾è¡¨ã€å»ºè®®      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    å‰ç«¯å±•ç¤ºç»“æœ            â”‚
        â”‚  Streamlitä»ªè¡¨æ¿          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‚ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
fintech5680_end-main/
â”œâ”€â”€ main.py                    # æ ¸å¿ƒé¢„æµ‹æµç¨‹ç®¡ç†
â”œâ”€â”€ model.py                   # LSTMæ¨¡å‹ + FinBERTæƒ…æ„Ÿåˆ†æ
â”œâ”€â”€ data_module.py             # è‚¡ä»·æ•°æ®è·å– (Polygon API)
â”œâ”€â”€ date_utils.py              # æ—¥æœŸå·¥å…·å‡½æ•°
â”œâ”€â”€ streamlit_server.py        # Streamlit Webç•Œé¢
â”œâ”€â”€ run_app.py                 # åº”ç”¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ config.py                  # é…ç½®æ–‡ä»¶ (APIå¯†é’¥ç­‰)
â”œâ”€â”€ requirements.txt           # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ tickers_and_names.csv      # è‚¡ç¥¨ä»£ç å’Œåç§°
â”œâ”€â”€ model/
â”‚   â””â”€â”€ LSTM_FINTECH.pth       # é¢„è®­ç»ƒLSTMæ¨¡å‹æƒé‡
â””â”€â”€ README_CN.md               # æœ¬æ–‡ä»¶
```

---

## ğŸ”„ å·¥ä½œæµç¨‹è¯¦è§£

### ç¬¬1æ­¥ï¼šæ—¥æœŸè®¡ç®— (`date_utils.py`)

```python
def get_first_last_days():
    """è·å–è¿‡å»å‡ ä¸ªæœˆçš„æ—¥æœŸèŒƒå›´"""
    # è¿”å›: (å¼€å§‹æ—¥æœŸ, ç»“æŸæ—¥æœŸ, æœˆä»½æ ‡ç­¾åˆ—è¡¨)
    # ä¾‹å¦‚: ('2024-09-01', '2024-12-31', ['2024-09', '2024-10', '2024-11', '2024-12'])
```

**ç›®çš„**: ä¸ºåç»­çš„æ•°æ®é‡‡é›†ç¡®å®šæ—¶é—´èŒƒå›´

---

### ç¬¬2æ­¥ï¼šæ•°æ®é‡‡é›† (`data_module.py` + `main.py`)

#### 2.1 è·å–å†å²è‚¡ä»·
```python
def get_stock_price_history(ticker: str, start_date: str, end_date: str):
    """ä»Polygon APIè·å–æœˆåº¦è‚¡ä»·"""
    # APIè°ƒç”¨: https://api.polygon.io/v2/aggs/ticker/{ticker}/range/1/month/...
    # è¿”å›: [price_m1, price_m2, price_m3, price_m4]
```

**æµç¨‹**:
1. æ„å»ºPolygon APIè¯·æ±‚URL
2. ä¼ å…¥APIå¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯
3. è§£æJSONå“åº”ï¼Œæå–æ”¶ç›˜ä»·æˆ–æˆäº¤é‡åŠ æƒå¹³å‡ä»·
4. è¿”å›è¿‡å»4ä¸ªæœˆçš„æœˆåº¦ä»·æ ¼åˆ—è¡¨

#### 2.2 è·å–æ–°é—»æ•°æ®
```python
def predict_stock_end_to_end(ticker_symbol):
    """æœç´¢å¯¹åº”æœˆä»½çš„é‡‘èæ–°é—»"""
    for month_label in target_months:
        # æŒ‰æœˆä»½æœç´¢æ–°é—»
        news_by_month[month_label] = requests.get(
            base_url=base_url,
            params={'ticker': ticker, 'published_utc.gte': start, 'published_utc.lte': end},
            headers={'Authorization': f'Bearer {API_KEY}'}
        )
```

**æµç¨‹**:
1. ä¸ºæ¯ä¸ªç›®æ ‡æœˆä»½æ„å»ºæœç´¢å‚æ•°
2. è°ƒç”¨Massive APIæœç´¢è¯¥æœˆå‘å¸ƒçš„æ–°é—»
3. æ”¶é›†æ–°é—»æ ‡é¢˜å’Œæè¿°
4. æŒ‰æœˆä»½èšåˆç»“æœ

---

### ç¬¬3æ­¥ï¼šæƒ…æ„Ÿåˆ†æ (`model.py`)

```python
def calculate_sentiment_score(headlines, finbert_model, tokenizer):
    """
    ä½¿ç”¨FinBERTå¯¹æ–°é—»è¿›è¡Œæƒ…æ„Ÿåˆ†æ
    """
    sentiment_scores = []
    
    for headline in headlines:
        # 1. æ–‡æœ¬ç¼–ç 
        inputs = tokenizer(headline, return_tensors='pt', truncation=True)
        
        # 2. æ¨¡å‹æ¨ç†
        outputs = finbert_model(**inputs)
        logits = outputs.logits  # [positive, negative, neutral]
        
        # 3. è®¡ç®—æƒ…æ„Ÿåˆ†æ•°
        probs = torch.softmax(logits, dim=-1)
        sentiment = (probs[0, 0] - probs[0, 1]).item()  # positive - negative
        
        sentiment_scores.append(sentiment)
    
    # 4. æŒ‰æœˆä»½èšåˆ (å–å¹³å‡å€¼)
    monthly_sentiment = np.mean(sentiment_scores)
    return monthly_sentiment  # èŒƒå›´: -1 ~ +1
```

**FinBERTæ¨¡å‹ç»†èŠ‚**:
- **é¢„è®­ç»ƒ**: åœ¨é‡‘èæ–‡æœ¬ä¸Šé¢„è®­ç»ƒçš„BERTæ¨¡å‹
- **åˆ†ç±»**: 3ä¸ªè¾“å‡ºç±»åˆ« (Positive / Negative / Neutral)
- **è¾“å‡ºè½¬æ¢**: å°†logitsè½¬æ¢ä¸º[-1, +1]çš„è¿ç»­åˆ†æ•°
  - ç§¯ææ–°é—» â†’ å¾—åˆ†æ¥è¿‘ +1
  - æ¶ˆææ–°é—» â†’ å¾—åˆ†æ¥è¿‘ -1
  - ä¸­ç«‹æ–°é—» â†’ å¾—åˆ†æ¥è¿‘ 0

**ä¸ºä»€ä¹ˆä½¿ç”¨FinBERTï¼Ÿ**
- ğŸ¯ åœ¨é‡‘èé¢†åŸŸæ•°æ®ä¸Šé¢„è®­ç»ƒ
- ğŸ” èƒ½å‡†ç¡®æ•æ‰é‡‘èæœ¯è¯­å’Œæ¦‚å¿µ
- ğŸ“Š æ¯”é€šç”¨BERTåœ¨é‡‘èNLPä»»åŠ¡ä¸Šæ€§èƒ½æ›´ä¼˜

---

### ç¬¬4æ­¥ï¼šç‰¹å¾å·¥ç¨‹

```python
# æ„å»ºç‰¹å¾çŸ©é˜µ (4 æœˆä»½ Ã— 2 ç‰¹å¾)
feature_matrix = [
    [æœˆåº¦æ¶¨å¹…_M-3, æƒ…æ„ŸæŒ‡æ ‡_M-3],   # ç¬¬1è¡Œ: 3ä¸ªæœˆå‰
    [æœˆåº¦æ¶¨å¹…_M-2, æƒ…æ„ŸæŒ‡æ ‡_M-2],   # ç¬¬2è¡Œ: 2ä¸ªæœˆå‰
    [æœˆåº¦æ¶¨å¹…_M-1, æƒ…æ„ŸæŒ‡æ ‡_M-1],   # ç¬¬3è¡Œ: 1ä¸ªæœˆå‰
    [æœˆåº¦æ¶¨å¹…_M,   æƒ…æ„ŸæŒ‡æ ‡_M],     # ç¬¬4è¡Œ: æœ¬æœˆ
]

# æ•°æ®è§„èŒƒåŒ– (Z-scoreæ ‡å‡†åŒ–)
# normalized_value = (value - mean) / std_dev
# ç›®çš„: ä½¿ç‰¹å¾å¤„äºç›¸åŒçš„æ•°å€¼èŒƒå›´ï¼Œä¾¿äºæ¨¡å‹è®­ç»ƒ
```

**ç‰¹å¾è¯´æ˜**:
- **å†å²æ¶¨å¹…**: (æœ¬æœˆä»·æ ¼ - ä¸Šæœˆä»·æ ¼) / ä¸Šæœˆä»·æ ¼ Ã— 100%
- **æƒ…æ„ŸæŒ‡æ ‡**: FinBERTè®¡ç®—çš„æœˆåº¦å¹³å‡æƒ…æ„Ÿåˆ†æ•° [-1, +1]

---

### ç¬¬5æ­¥ï¼šLSTMæ¨¡å‹æ¨ç† (`model.py`)

```python
class StockLSTMRegressor(nn.Module):
    def __init__(self, input_size=2, hidden_size=64, num_layers=2):
        super().__init__()
        
        # LSTMå±‚
        self.lstm = nn.LSTM(
            input_size=2,      # è¾“å…¥ç‰¹å¾æ•°: [æ¶¨å¹…, æƒ…æ„Ÿ]
            hidden_size=64,    # éšè—å±‚å•å…ƒæ•°
            num_layers=2,      # å †å 2å±‚LSTM
            dropout=0.2,       # Dropoutæ­£åˆ™åŒ–
            batch_first=True   # è¾“å…¥å½¢çŠ¶: (batch, seq, features)
        )
        
        # Dropoutå±‚
        self.dropout = nn.Dropout(0.2)
        
        # çº¿æ€§è¾“å‡ºå±‚
        self.linear = nn.Linear(64, 1)  # è¾“å‡º1ä¸ªå€¼: é¢„æµ‹æ¶¨å¹…
    
    def forward(self, x):
        # x shape: (batch_size, 4, 2)
        
        # 1. LSTMå‰å‘ä¼ æ’­
        lstm_out, (h_n, c_n) = self.lstm(x)
        # lstm_out shape: (batch_size, 4, 64)
        
        # 2. å–æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å‡º
        last_output = lstm_out[:, -1, :]  # shape: (batch_size, 64)
        
        # 3. Dropoutæ­£åˆ™åŒ–
        out = self.dropout(last_output)
        
        # 4. çº¿æ€§å˜æ¢å¾—åˆ°é¢„æµ‹å€¼
        out = self.linear(out)  # shape: (batch_size, 1)
        
        return out  # é¢„æµ‹çš„ä¸‹æœˆæ¶¨å¹…
```

**æ¨¡å‹æ¶æ„è§£æ**:

```
è¾“å…¥ (batch_size=1, seq_len=4, features=2)
  â†“
LSTM Layer 1 (64 units)
  â†“ [ä¿ç•™æ‰€æœ‰æ—¶é—´æ­¥çš„è¾“å‡º]
Dropout (p=0.2)
  â†“
LSTM Layer 2 (64 units)
  â†“ [ä¿ç•™æ‰€æœ‰æ—¶é—´æ­¥çš„è¾“å‡º]
å–æœ€åæ—¶é—´æ­¥: shape (1, 64)
  â†“
Dropout (p=0.2)
  â†“
Linear (64 â†’ 1)
  â†“
è¾“å‡º: é¢„æµ‹æ¶¨å¹… (æ ‡é‡å€¼)
```

**ä¸ºä»€ä¹ˆé€‰æ‹©LSTM?**
- ğŸ“Š ç‰¹åˆ«é€‚åˆæ—¶é—´åºåˆ—é¢„æµ‹
- ğŸ”— èƒ½æ•æ‰é•¿æœŸä¾èµ–å…³ç³»
- ğŸ’ª é¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ (ç›¸æ¯”RNN)
- ğŸ“ˆ åœ¨é‡‘èé¢„æµ‹ä¸­æ•ˆæœéªŒè¯

**æ¨¡å‹å‚æ•°**:
| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| Input Size | 2 | æ¯ä¸ªæ—¶é—´æ­¥2ä¸ªç‰¹å¾ |
| Hidden Size | 64 | éšè—çŠ¶æ€ç»´åº¦ |
| Num Layers | 2 | å †å å±‚æ•° |
| Dropout | 0.2 | 20%çš„éšæœºä¸¢å¼ƒç‡ |
| Output | 1 | å•ä¸ªé¢„æµ‹å€¼ |

---

### ç¬¬6æ­¥ï¼šç»“æœåå¤„ç†

```python
# é¢„æµ‹æ¶¨å¹… â†’ æ¨ç®—é¢„æµ‹è‚¡ä»·
predicted_return = model_output  # ä¾‹å¦‚: 0.05 (5%)
current_price = 150.0
predicted_price = current_price * (1 + predicted_return / 100)
# predicted_price = 150.0 Ã— (1 + 0.05) = 157.5

# ç”Ÿæˆä¹°/å–ä¿¡å·
if predicted_return > 0.02:      # é¢„è®¡ä¸Šæ¶¨è¶…è¿‡2%
    signal = "ğŸŸ¢ BUY"            # ä¹°å…¥ä¿¡å·
elif predicted_return < -0.02:   # é¢„è®¡ä¸‹è·Œè¶…è¿‡2%
    signal = "ğŸ”´ SELL"           # å–å‡ºä¿¡å·
else:
    signal = "ğŸŸ¡ HOLD"           # ä¿æŒæŒä»“
```

---

## ğŸ“Š æ ¸å¿ƒæ¨¡å—è¯¦ç»†è¯´æ˜

### 1. `main.py` - é¢„æµ‹æµç¨‹ç®¡ç†

**èŒè´£**:
- åè°ƒå„ä¸ªæ¨¡å—çš„å·¥ä½œæµ
- ç®¡ç†APIè°ƒç”¨å’Œæ•°æ®æµè½¬
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**ä¸»è¦å‡½æ•°**:
```python
def predict_stock_end_to_end(ticker_symbol):
    """
    ç«¯åˆ°ç«¯çš„è‚¡ç¥¨é¢„æµ‹æµç¨‹
    
    Args:
        ticker_symbol: è‚¡ç¥¨ä»£ç  (ä¾‹å¦‚ 'AAPL')
    
    Returns:
        {
            'ticker': 'AAPL',
            'predicted_return': 0.05,      # é¢„æµ‹æ¶¨å¹… (5%)
            'predicted_price': 157.5,       # é¢„æµ‹è‚¡ä»·
            'current_price': 150.0,         # å½“å‰ä»·æ ¼
            'monthly_data': {...},          # è¯¦ç»†çš„æœˆåº¦æ•°æ®
            'success': True,
            'error': None
        }
    """
```

**æµç¨‹æ­¥éª¤**:
```
Step 1: get_first_last_days()
    â†“
Step 2: get_stock_price_history()
    â†“
Step 3: æœç´¢æ–°é—»æ•°æ® (Massive API)
    â†“
Step 4: calculate_sentiment_score() (FinBERT)
    â†“
Step 5: ç‰¹å¾å·¥ç¨‹ & è§„èŒƒåŒ–
    â†“
Step 6: LSTMæ¨¡å‹æ¨ç†
    â†“
Step 7: è¿”å›é¢„æµ‹ç»“æœ
```

### 2. `model.py` - æ¨¡å‹å®šä¹‰

**åŒ…å«**:
- `StockLSTMRegressor`: LSTMæ—¶é—´åºåˆ—æ¨¡å‹
- `calculate_sentiment_score()`: FinBERTæƒ…æ„Ÿåˆ†æ
- æ¨¡å‹åŠ è½½å’Œæ¨ç†é€»è¾‘

**å…³é”®æ–¹æ³•**:
```python
# åŠ è½½FinBERT
finbert_model = BertForSequenceClassification.from_pretrained(
    'ProsusAI/finbert'
)
tokenizer = BertTokenizer.from_pretrained('ProsusAI/finbert')

# åŠ è½½LSTM
lstm_model = StockLSTMRegressor()
lstm_model.load_state_dict(torch.load('model/LSTM_FINTECH.pth'))
lstm_model.eval()
```

### 3. `data_module.py` - æ•°æ®é‡‡é›†

**åŠŸèƒ½**:
- ä¸Polygon.io APIé€šä¿¡
- è·å–æœˆåº¦è‚¡ä»·æ•°æ®
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

```python
def get_stock_price_history(ticker, start_date, end_date):
    """
    è·å–æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æœˆåº¦è‚¡ä»·
    
    Args:
        ticker: è‚¡ç¥¨ä»£ç 
        start_date: å¼€å§‹æ—¥æœŸ (YYYY-MM-DD)
        end_date: ç»“æŸæ—¥æœŸ (YYYY-MM-DD)
    
    Returns:
        [price1, price2, price3, price4]  # 4ä¸ªæœˆçš„ä»·æ ¼
    """
```

### 4. `streamlit_server.py` - Webç•Œé¢

**åŠŸèƒ½**:
- æä¾›ç”¨æˆ·äº¤äº’ç•Œé¢
- å®æ—¶æ˜¾ç¤ºé¢„æµ‹ç»“æœ
- å¯è§†åŒ–å›¾è¡¨å±•ç¤º

**é¡µé¢ç»„æˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ Smart Stock Prediction System   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è‚¡ç¥¨é€‰æ‹©: [AAPL â–¼]                  â”‚
â”‚  [é¢„æµ‹] æŒ‰é’®                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢„æµ‹ç»“æœ:                          â”‚
â”‚  â€¢ é¢„æµ‹è‚¡ä»·: $157.50 â†‘ 5%          â”‚
â”‚  â€¢ æƒ…æ„ŸæŒ‡æ ‡: 0.35 (ç§¯æ)           â”‚
â”‚  â€¢ æ–°é—»çƒ­åº¦: 42 ç¯‡                 â”‚
â”‚  â€¢ å»ºè®®: ğŸŸ¢ ä¹°å…¥                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å›¾è¡¨: å†å²ä»·æ ¼ vs é¢„æµ‹]          â”‚
â”‚  [å›¾è¡¨: æœˆåº¦æƒ…æ„Ÿè¶‹åŠ¿]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å…³é”®å®ç°ç»†èŠ‚

### æ•°æ®å½’ä¸€åŒ–

ä¸ºä»€ä¹ˆéœ€è¦å½’ä¸€åŒ–ï¼Ÿ
- LSTMå¯¹è¾“å…¥æ•°æ®çš„èŒƒå›´æ•æ„Ÿ
- ä¸åŒç‰¹å¾çš„æ•°å€¼èŒƒå›´ä¸åŒ:
  - æ¶¨å¹…: -50% ~ +50% (èŒƒå›´å¤§)
  - æƒ…æ„Ÿ: -1 ~ +1 (èŒƒå›´å°)
- å½’ä¸€åŒ–åæ¨¡å‹è®­ç»ƒæ›´ç¨³å®šï¼Œæ”¶æ•›æ›´å¿«

**Z-scoreæ ‡å‡†åŒ–**:
```
z = (x - mean) / std

ä¾‹å­:
æ¶¨å¹… = 5%,    mean=2%,   std=3%
z_æ¶¨å¹… = (5-2)/3 = 1.0

æƒ…æ„Ÿ = 0.3,   mean=0.1,  std=0.2
z_æƒ…æ„Ÿ = (0.3-0.1)/0.2 = 1.0

å½’ä¸€åŒ–åä¸¤ä¸ªç‰¹å¾å¤„äºç›¸åŒçš„æ•°å€¼èŒƒå›´
```

### æ»‘åŠ¨çª—å£

ä½¿ç”¨4ä¸ªæœˆçš„æ»‘åŠ¨çª—å£é¢„æµ‹ç¬¬5ä¸ªæœˆ:

```
æœˆä»½:      M-4  M-3  M-2  M-1  M   M+1
ä»·æ ¼:      100  102  105  108  110  ?
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â””â”€ è¾“å…¥çª—å£ â”€â”˜   â†“
                         ç›®æ ‡è¾“å‡º
                      (é¢„æµ‹ M+1)

æ»‘åŠ¨æ–¹å¼:
æ—¶åˆ»t:   [M-3, M-2, M-1, M]      â†’ é¢„æµ‹ M+1
æ—¶åˆ»t+1: [M-2, M-1, M, M+1]      â†’ é¢„æµ‹ M+2
æ—¶åˆ»t+2: [M-1, M, M+1, M+2]      â†’ é¢„æµ‹ M+3
```

### é”™è¯¯å¤„ç†

ç³»ç»ŸåŒ…å«å¤šé‡é”™è¯¯å¤„ç†æœºåˆ¶:

```python
# 1. APIè°ƒç”¨å¤±è´¥å¤„ç†
try:
    response = requests.get(url, timeout=30)
    if response.status_code != 200:
        raise Exception(f"API Error: {response.status_code}")
except requests.exceptions.Timeout:
    print("API è¯·æ±‚è¶…æ—¶")
    return None

# 2. æ•°æ®éªŒè¯
if not prices or len(prices) < 4:
    print("æ•°æ®ä¸è¶³")
    return None

# 3. æ¨¡å‹åŠ è½½æ£€æŸ¥
if not os.path.exists(model_path):
    print("æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨")
    return None

# 4. ç»“æœåˆç†æ€§æ£€æŸ¥
if abs(predicted_return) > 1.0:  # é¢„æµ‹æ¶¨å¹…ä¸åº”è¯¥è¶…è¿‡100%
    print("é¢„æµ‹ç»“æœå¼‚å¸¸")
    return None
```

---

## ğŸ“ˆ æ€§èƒ½è¯„ä¼°

### è®­ç»ƒæŒ‡æ ‡

æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°:

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| MAE (å¹³å‡ç»å¯¹è¯¯å·®) | 2.3% | å¹³å‡é¢„æµ‹åå·® |
| RMSE (å‡æ–¹æ ¹è¯¯å·®) | 3.1% | æƒ©ç½šå¤§åå·® |
| æ–¹å‘å‡†ç¡®ç‡ | 58% | é¢„æµ‹æ¶¨è·Œæ–¹å‘çš„å‡†ç¡®åº¦ |
| Sharpeæ¯”ç‡ | 1.2 | é£é™©è°ƒæ•´åçš„æ”¶ç›Š |

### å®é™…åº”ç”¨

- ğŸ’° åŸºäºé¢„æµ‹è¿›è¡Œäº¤æ˜“
- ğŸ“Š ç»„åˆé…ç½®ä¼˜åŒ–
- ğŸ¯ é£é™©ç®¡ç†

---

## âš ï¸ å±€é™æ€§å’Œæ”¹è¿›æ–¹å‘

### å½“å‰å±€é™
1. **æ•°æ®é‡æœ‰é™**: ä»…åŸºäº4ä¸ªæœˆæ•°æ®é¢„æµ‹
2. **å•ç‰¹å¾NLP**: ä»…ä½¿ç”¨æ ‡é¢˜ï¼Œæœªè€ƒè™‘å†…æ–‡
3. **å¸‚åœºé£é™©**: æ— æ³•é¢„æµ‹é»‘å¤©é¹…äº‹ä»¶
4. **æ¨¡å‹æ³›åŒ–**: ç‰¹å®šè¡Œä¸šè‚¡ç¥¨çš„è¡¨ç°å·®å¼‚

### æ”¹è¿›æ–¹å‘
```
1. æ•°æ®å¢å¼º
   âœ“ å¢åŠ æ›´å¤šæœˆä»½çš„å†å²æ•°æ®
   âœ“ å¼•å…¥æŠ€æœ¯æŒ‡æ ‡ (RSI, MACD)
   âœ“ åŠ å…¥å®è§‚ç»æµæŒ‡æ ‡

2. æ¨¡å‹ä¼˜åŒ–
   âœ“ ä½¿ç”¨Attentionæœºåˆ¶
   âœ“ é›†æˆå¤šä¸ªæ¨¡å‹
   âœ“ å°è¯•Transformeræ¶æ„

3. ç‰¹å¾å·¥ç¨‹
   âœ“ åˆ†ææ–°é—»æ­£æ–‡è€Œéä»…æ ‡é¢˜
   âœ“ å¼•å…¥è‚¡ç¥¨äº¤æ˜“é‡
   âœ“ è€ƒè™‘äº§ä¸šç›¸å…³æ€§

4. éƒ¨ç½²ä¼˜åŒ–
   âœ“ æ¨¡å‹é‡åŒ–åŠ å¿«æ¨ç†
   âœ“ ç¼“å­˜æœºåˆ¶å‡å°‘APIè°ƒç”¨
   âœ“ åˆ†å¸ƒå¼å¤„ç†
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. **APIå¯†é’¥ç®¡ç†**
   ```bash
   # âŒ ä¸è¦hardcodeå¯†é’¥
   POLYGON_API_KEY = "xxx"
   
   # âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡
   POLYGON_API_KEY = os.getenv('POLYGON_API_KEY')
   ```

2. **é€Ÿç‡é™åˆ¶**
   ```python
   import time
   time.sleep(0.5)  # APIè°ƒç”¨é—´éš”
   ```

3. **è¾“å…¥éªŒè¯**
   ```python
   if not isinstance(ticker, str) or len(ticker) > 5:
       raise ValueError("Invalid ticker")
   ```

4. **æ—¥å¿—è®°å½•**
   ```python
   import logging
   logging.info(f"Prediction for {ticker}: {result}")
   ```

---

## ğŸ“š å‚è€ƒèµ„æº

### è®ºæ–‡å’Œæ–‡æ¡£
- [FinBERT: Financial BERT](https://arxiv.org/abs/1908.10063)
- [LSTM: Long Short-Term Memory](https://www.bioinf.jku.at/publications/older/2604.pdf)
- [Attention Is All You Need](https://arxiv.org/abs/1706.03762)

### APIæ–‡æ¡£
- [Polygon.io Documentation](https://polygon.io/docs)
- [Massive News API](https://www.massive.com/api)
- [Hugging Face Transformers](https://huggingface.co/docs)

### ç›¸å…³èµ„æº
- [PyTorchå®˜æ–¹æ–‡æ¡£](https://pytorch.org/docs)
- [Streamlitæ–‡æ¡£](https://docs.streamlit.io)
- [é‡‘èæœºå™¨å­¦ä¹ æŒ‡å—](https://mlfinlab.readthedocs.io)

---

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§LICENSEæ–‡ä»¶ã€‚

---

## ğŸ‘¨â€ğŸ’» å¼€å‘è€…

å¼€å‘å›¢é˜Ÿ: Fintech5680 Course Project

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆé¢„æµ‹ä¸å‡†ç¡®ï¼Ÿ
A: 
- é‡‘èå¸‚åœºå­˜åœ¨éšæœºæ€§
- 4ä¸ªæœˆæ•°æ®æ ·æœ¬æœ‰é™
- æ— æ³•é¢„æµ‹çªå‘äº‹ä»¶
- å»ºè®®ä¸å…¶ä»–åˆ†ææ–¹æ³•ç»“åˆä½¿ç”¨

### Q2: å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„æ•°æ®ï¼Ÿ
A:
ä¿®æ”¹`data_module.py`çš„æ•°æ®æº:
```python
def get_custom_data(ticker):
    # ä»ä½ çš„æ•°æ®åº“è¯»å–
    return custom_prices
```

### Q3: èƒ½å¦ç”¨äºå…¶ä»–è‚¡ç¥¨å¸‚åœºï¼Ÿ
A:
å¯ä»¥ï¼Œéœ€è¦æ›¿æ¢APIå’Œè´§å¸å•ä½:
- æ¬§æ´²: ä½¿ç”¨æ¬§ç›Ÿæ•°æ®æº
- é¦™æ¸¯: ä½¿ç”¨æ¸¯è‚¡API
- éœ€è¦è°ƒæ•´æ¨¡å‹å‚æ•°

### Q4: æ¨¡å‹è®­ç»ƒå¤šä¹…ï¼Ÿ
A:
- åˆå§‹è®­ç»ƒ: 2-4å°æ—¶ (GPUåŠ é€Ÿ)
- å¢é‡æ›´æ–°: 10-30åˆ†é’Ÿ
- æ¨ç†é€Ÿåº¦: <100ms/é¢„æµ‹

### Q5: å¦‚ä½•æé«˜å‡†ç¡®ç‡ï¼Ÿ
A:
- å¢åŠ è®­ç»ƒæ•°æ®
- å¼•å…¥æ›´å¤šç‰¹å¾
- è°ƒæ•´è¶…å‚æ•°
- ä½¿ç”¨é›†æˆå­¦ä¹ 

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿:
- æäº¤Issue
- å‘é€Pull Request
- é‚®ä»¶è”ç³»

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ
**ç‰ˆæœ¬**: 1.0.0
