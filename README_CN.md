
4 FinBERT–LSTM 智能股票预测系统

本报告描述了一个面向生产的 FinBERT–LSTM 管道：将金融新闻中的情感信号与历史月度回报相结合，用于预测下一月的股票回报。设计目标包括模块化、数据质量校验以及易于在本地或服务器环境中重复部署的可复现性。

4.1 模型架构

系统采用两阶段流水线。第一阶段使用领域专用的 Transformer（FinBERT）将单条新闻标题映射为情感分数，并在月度尺度上聚合为情感指标；第二阶段使用堆叠 LSTM 接受四个月的特征序列（每月特征为[月回报, 月度情感]），输出下一月的回报预测。流水线支持独立替换或升级 NLP 与时序组件，并在模型推理前执行特征归一化、缺失值处理与输入校验。

4.2 FinBERT 情感模块

FinBERT 模块负责文本预处理（分词、截断/填充、attention mask）、批量推理以及将类别 logits 映射为带符号的连续情感分数（例如正向概率减负向概率）。针对每月的多条文章，默认使用算术平均进行聚合，也支持中位数或截尾均值以提高鲁棒性。实现包含针对新闻稀疏月份的降级策略（回退为中性分数）以及本地缓存机制以减少重复推理开销。

4.3 LSTM 预测模块

LSTM 预测器采用紧凑设计以适应金融时序的小样本特性：两层堆叠 LSTM（每层 64 隐单元）、层间 dropout、以及将最终时间步表示映射到标量回报的线性回归头。输入按特征标准化，长度不足的序列通过填充中性值处理。推理接口支持批量输入并可选地返回不确定性代理（例如集成或 MC-dropout 输出），以辅助下游决策逻辑。

4.4 训练与评估

训练采用监督学习与滑动窗口方法：以 4 个月为输入窗口，目标为随后一月的回报。优化器为 Adam，损失函数为均方误差（MSE），并使用 L2 权重衰减与 dropout 进行正则化。模型选择采用时间感知的验证策略（扩展窗口或 walk-forward 划分），评估指标包括 MAE、RMSE 与方向准确率。鲁棒性测试覆盖缺失新闻场景、不同情感聚合方法以及输入缩放敏感性；通过早停与检查点保存最优模型权重。

4.5 API 设计与实时系统

生产服务暴露 REST/HTTP 接口以编排数据检索、特征组装、情感打分和模型推理。典型请求流： (1) 从价格 API 拉取历史月度价格；(2) 收集对应月份的新闻标题；(3) 使用 FinBERT 计算并聚合月度情感；(4) 组装并归一化 4 个月输入矩阵；(5) 运行 LSTM 推理并返回预测回报与推导价格。服务包含缓存层、可配置的超时与重试策略、结构化错误响应以及日志/指标以支持监控；部署脚本与环境变量配置保证在云端与本地环境中的可重复运行。

4.6 结论

将 FinBERT 得到的文本情感与紧凑 LSTM 时序模型融合，构成了一个务实且可解释的预测流水线：该方法能在保留价格时序建模能力的同时，更快对新出现的文本信息做出反应。其模块化、鲁棒性的设计与面向接口的实现，使该方案既适用于研究实验，也适合快速原型化的生产部署。
本部分介绍基于 FinBERT 与 LSTM 结合的智能股票预测系统。该架构将专门用于金融领域的转换器模型（FinBERT）与紧凑型的 LSTM 时序预测器配对，以生成月度股票回报率预测。该设计旨在将来自金融新闻的文本信号与历史价格变动结合起来，使模型既对新信息敏感，又对噪声价格波动具有鲁棒性。

4.1 模型架构

系统架构遵循两阶段流水线。第一阶段对金融新闻标题进行分词并传入 FinBERT。FinBERT 处理每条标题并输出类别 logits，再将这些 logits 转换为连续的情感分数。同一月份内的标题通过聚合（例如取平均）得到该月的情感指标。第二阶段将月度情感指标与历史价格数据计算得到的月度回报结合，构建序列长度为 4 的特征矩阵。该矩阵随后作为输入传入堆叠的 LSTM 模型，学习时间依赖并输出预测的月度回报。该流水线的模块化设计允许自然语言处理组件和时序预测器独立更新。

4.2 FinBERT 情感模块

FinBERT 模块负责将原始新闻标题转换为定量的情感分数。每条标题在输入前进行分词并添加特殊标记与注意力掩码；输入会被截断或填充到固定长度以保证计算一致性。FinBERT 的 Transformer 层计算上下文嵌入并输出情感类别的 logits。通过 softmax 将 logits 转为概率，再应用从类别概率到带符号情感分数的映射（例如正向概率减去负向概率）。月度情感通过对该月所有文章的得分取平均得到，该汇总值为 LSTM 提供了简明的情绪表示。

4.3 LSTM 预测模块

LSTM 预测器接收的序列中每个时间步是一个二维向量：当月回报率与当月情感得分。实现的网络使用两个堆叠的 LSTM 层，每层 64 个隐藏单元，后接 dropout 与线性输出层，用于生成单一的标量——预测的月度回报。LSTM 使用 batch-first 模式，并提取最终时间步的表示用于回归。此配置在模型容量与过拟合控制之间取得平衡。

4.4 训练与评估

模型以监督学习方式训练，训练样本由四个月的输入窗口与随后一个月的回报构成目标。训练使用均方误差作为损失函数，并采用 Adam 优化器。正则化策略包括 LSTM 内部的 dropout 与 L2 权重衰减。模型性能使用适用于时间序列的时间切分验证策略评估，并以均绝对误差、均方根误差等回归指标以及方向准确率来衡量预测回报是否正确判断涨跌。在评估阶段，通过对新闻稀疏月份用中性情感替代来测试模型在缺失新闻或数据稀疏条件下的鲁棒性。

4.5 API 设计与实时系统

系统对外暴露了一个简单的服务接口，用于编排数据检索、情感分析与预测流程。在部署环境中，Web 应用会调用服务器端的端点以触发端到端流水线。端点首先从价格 API 获取历史价格序列，并检索相关月份的新闻文章。文本数据被传递到 FinBERT 模块并聚合为月度情感。特征装配将价格和情感转换为 LSTM 的输入矩阵；模型进行一次推理以输出预测回报，并进一步换算为预测价格。服务包含对外部 API 响应的缓存、请求超时与重试机制，以及对部分失败的清晰错误提示，从而保证响应性良好的用户体验。

4.6 结论

FinBERT–LSTM 的集合方法展示了如何将领域特定的语言模型与传统时序神经网络相结合以提升金融预测性能。通过将新闻衍生的情感与历史回报模式融合，系统能在新信息出现时较纯技术模型更快地做出反应。该架构模块化，特征级别可解释，并可作为实时 Web 服务方便地部署，适用于研究与原型生产环境。

智能股票预测系统的有效性源于其结合两个互补信息来源的能力，每个来源都为未来股票价格走势提供了独特的洞察。历史价格数据使 LSTM 网络能够学习时间模式，例如动力效应（最近的价格上升趋向于在短期内持续）或均值回归模式（极端走势趋向于逆转）。然而，仅凭历史价格数据只能捕捉过去的市场行为，无法解释市场中的结构性变化或公司特定事件。

情感分析的加入通过整合关于市场期望和新兴市场事件的前瞻性信息解决了这一局限。关于新产品发布、监管变化、收益意外或竞争威胁的新闻文章反映了市场参与者对未来现金流和风险的当前信念。通过将这些情感信号与历史模式相结合，模型可以在出现表明未来会与过去不同的新信息时调整其预测。例如，如果一家公司因主要合同签署而获得新闻报道（正面情感），而其股票一直在下跌（负面回报率），该模型可以将其识别为潜在的转折机会。

该系统的实际有效性通过几个关键性能指标体现。该模型成功地在许多情况下捕捉了价格走势的方向准确性，正确预测下个月的回报率是否为正（看涨）或负（看跌）。系统的置信度通过预测回报率的大小进行校准，较大的预测走势表明更高的置信度。在验证测试中，该模型通过结合极端情感与历史价格模式展示了识别高估和低估情景的能力。在训练期间纳入 dropout 正则化以及使用多月时间窗口有助于防止过拟合，使模型对样本外预测更具可泛化性。

## 技术实现细节

该系统建立在精心选择的现代机器学习技术栈上，该栈因其稳健性、可扩展性和对金融应用的适用性而被选中。PyTorch 用作神经网络框架，为 LSTM 模型提供了高效的梯度计算和 GPU 加速。Hugging Face Transformers 库提供了对 FinBERT 等预训练模型的访问，消除了在金融文本上重新训练大型语言模型的需要，这需要大量的计算资源和标记训练数据。Streamlit 为网络界面的快速原型设计和部署提供支持，抽象化了复杂的前端开发细节，允许集中于机器学习组件。

数据处理和数值计算通过 Pandas 和 NumPy 进行管理，为金融时间序列数据提供了高效的操作。该系统与外部 API 集成，包括 Polygon.io 用于历史股票价格数据，以及专门的金融新闻 API 用于标题数据。实施了 API 速率限制和错误处理，以确保当外部服务不可用或达到使用限制时的可靠性。配置管理通过环境变量和集中式配置文件进行实施，允许系统在不同环境（本地开发、测试服务器、生产云托管）中部署而无需代码修改。

预训练的 LSTM 模型（存储在 model/LSTM_FINTECH.pth）使用监督学习在历史数据上进行了训练，其中目标变量是下个月的股票回报率，输入特征是前面描述的 4 个月回报率和情感评分序列。该模型采用了 Adam 优化器进行高效的基于梯度的学习，使用均方误差作为损失函数，这对连续回报率预测是合适的。训练过程纳入了正则化技术，包括 dropout、L2 权重正则化和早期停止，以防止过拟合并确保对未来、看不见的数据的良好泛化。

## 部署和使用

智能股票预测系统可以通过多种部署选项进行访问和使用，具体取决于用户的需求。为了在没有任何安装或配置的情况下立即访问，实时网络应用程序可在 https://fintech5680end-hz5t7pjv8wfhniwcyxtnge.streamlit.app/ 获得。用户只需在浏览器中导航至此 URL，就可以立即开始进行股票预测。网络界面提供了直观的体验，用户从下拉菜单中选择股票，然后点击按钮启动预测流程。结果在几秒内显示，包括预测价格、预期回报率百分比、投资建议、历史分析图表和相关新闻文章。

对于对本地开发或系统自定义感兴趣的用户，应用程序可在个人计算机或开发服务器上本地部署。从项目仓库克隆后，使用 pip 从 requirements.txt 文件安装依赖项，用户可以使用简单命令启动 Streamlit 服务器本地，使应用程序在 http://localhost:8501 上可用。这个本地部署选项对于在模型修改、连接到不同数据源或从事功能增强上进行实验的研究人员、数据工程师或开发人员很有用。

对于生产服务器部署，系统需要将特定文件上传到服务器环境，包括主要应用程序文件（streamlit_server.py）、所有 Python 模块（main.py、model.py、data_module.py、date_utils.py）、配置文件（config.py）、预训练的模型权重（model/LSTM_FINTECH.pth）、支持数据文件（如股票代码列表）和指定所有 Python 包依赖项的 requirements.txt 文件。值得注意的是，虚拟环境（.venv 文件夹）不需要上传，因为服务器将创建自己的隔离 Python 环境。一旦文件被上传并安装了依赖项，服务器管理员可以在指定端口上启动 Streamlit 应用程序，然后应用程序可通过服务器的网络地址或域名供最终用户访问。

## 结果和结论

智能股票预测系统成功展示了将深度学习技术与金融市场数据相结合来创建功能性股票价格预测工具的可行性和实际效用。FinBERT 情感分析与 LSTM 时间序列建模的整合产生了一个识别并利用定量历史模式和定性市场情感信号的系统。通过将金融新闻数据处理通过域特定的自然语言处理模型，并通过递归神经网络将这些信号与历史价格走势相结合，该系统实现了超过任何一种方法单独能提供的结果。

该项目的关键贡献涵盖多个维度。从技术角度来看，系统展示了将最先进的深度学习模型成功整合到生产就绪的金融应用中，具有适当的错误处理、部署策略和用户界面考虑。从金融分析角度来看，系统提供了证据表明新闻情感包含关于未来股票价格的预测信息，验证了行为金融学学术研究的发现。从机器学习角度来看，该项目通过结合异构数据源（数值价格数据和文本新闻数据）成为统一预测框架的有效特征工程展示了范例。

该系统通过基于技术和基本面分析的两者提供用户可行的投资洞察来实现其实际目标。用户可以快速评估股票价格走势的预期方向并获得定量买入/卖出/持有建议。历史趋势的可视化以及相关新闻文章的整合为驱动预测的因素提供了透明度，使系统的输出比黑盒预测模型更具可解释性。展望未来，该系统可以通过额外的技术指标、宏观经济变量和替代 LSTM 架构进行增强，为金融机器学习应用领域的进一步研究和开发创造了机会。